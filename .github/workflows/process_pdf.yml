name: üì• GST PDF Automator

on:
  workflow_dispatch:
    inputs:
      pdf_url:
        description: 'The direct URL to the GST Notification PDF'
        required: true
        type: string
      # New Optional Inputs for manual override:
      manual_date:
        description: 'Optional: Manually provide the date (e.g., 25/11/2025) to skip PDF parsing.'
        required: false
        type: string
      manual_subject:
        description: 'Optional: Manually provide the subject/purpose (e.g., CGST_Rate_Change).'
        required: false
        type: string
      commit_message:
        description: 'Optional: Custom commit message'
        required: false
        default: 'Auto-downloaded and renamed GST Notification'

jobs:
  download_and_commit:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: üêç Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' 
          
      - name: üì¶ Install dependencies
        run: pip install -r requirements.txt
        
      - name: ‚öôÔ∏è Run Python Script to Process PDF
        # Now passing all three inputs to the Python script
        # The script will decide whether to use the manual inputs or read the PDF
        run: |
          python gst_processor.py \
            "${{ github.event.inputs.pdf_url }}" \
            "${{ github.event.inputs.manual_date }}" \
            "${{ github.event.inputs.manual_subject }}"

      - name: üíæ Commit and Push Renamed File
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: ${{ github.event.inputs.commit_message }} - ${{ github.event.inputs.pdf_url }}
          file_pattern: notifications/*.pdf
          commit_user_name: GST Bot
          commit_user_email: actions@github.com
          commit_author: GST Bot <actions@github.com>
